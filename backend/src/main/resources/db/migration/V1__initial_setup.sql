CREATE TABLE IF NOT EXISTS skjema (id uuid PRIMARY KEY, virksomhetsnummer TEXT NOT NULL, kontaktperson_navn TEXT NOT NULL, kontaktperson_epost TEXT NOT NULL, kontaktperson_telefon TEXT NOT NULL, ansatt_fodselsnummer TEXT NOT NULL, ansatt_navn TEXT NOT NULL, ekspert_navn TEXT NOT NULL, ekspert_virksomhet TEXT NOT NULL, ekspert_kompetanse TEXT NOT NULL, ekspert_problemstilling TEXT NOT NULL, tiltak_for_tilrettelegging TEXT NOT NULL, bestilling_kostnad TEXT NOT NULL, bestilling_start_dato TEXT NOT NULL, nav_kontakt TEXT NOT NULL, opprettet_av TEXT NOT NULL, opprettet_tidspunkt TEXT NOT NULL);
CREATE INDEX skjema_virksomhetsnummer ON skjema (virksomhetsnummer);
CREATE TABLE IF NOT EXISTS utkast (id uuid PRIMARY KEY, virksomhetsnummer TEXT NULL, kontaktperson_navn TEXT NULL, kontaktperson_epost TEXT NULL, kontaktperson_telefon TEXT NULL, ansatt_fodselsnummer TEXT NULL, ansatt_navn TEXT NULL, ekspert_navn TEXT NULL, ekspert_virksomhet TEXT NULL, ekspert_kompetanse TEXT NULL, ekspert_problemstilling TEXT NULL, tiltak_for_tilrettelegging TEXT NULL, bestilling_kostnad TEXT NULL, bestilling_start_dato TEXT NULL, nav_kontakt TEXT NULL, opprettet_av TEXT NOT NULL, opprettet_tidspunkt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL);
CREATE INDEX utkast_virksomhetsnummer ON utkast (virksomhetsnummer);
CREATE INDEX utkast_opprettet_av ON utkast (opprettet_av);
CREATE TABLE IF NOT EXISTS event_queue (id BIGSERIAL PRIMARY KEY, event_json JSON NOT NULL, status INT DEFAULT 0 NOT NULL, attempts INT DEFAULT 0 NOT NULL, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL);
CREATE INDEX statusOppdatert ON event_queue (status, updated_at, id);
CREATE TABLE IF NOT EXISTS event_log (id BIGINT PRIMARY KEY, event_json JSON NOT NULL, status INT DEFAULT 0 NOT NULL, errors JSON DEFAULT '[]'::json NOT NULL, attempts INT DEFAULT 0 NOT NULL, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL);
CREATE TABLE IF NOT EXISTS event_handler_states (id BIGINT, handler_id TEXT, "result" JSON NOT NULL, error_message TEXT NULL, CONSTRAINT pk_event_handler_states PRIMARY KEY (id, handler_id));
CREATE SEQUENCE IF NOT EXISTS event_queue_id_seq START WITH 1 MINVALUE 1 MAXVALUE 9223372036854775807;
