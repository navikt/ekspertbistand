# TODO
- [x] maven build runnable for cloud native
- [x] set up Dockerfile with chaingguard
- [x] set up texas and authentication, check latest practices
- [x] set up logback with logstash and masking
- [x] test api with mocked auth / no auth
  - [x] option1 stub authentication middleware in the test application
    - simplest, also we dont actually need to test the middleware
  - [ ] option2 mock texas client to always return a valid user.
    - more complex, but also more realistic, the texas client code is also tested
  - [ ] option3 create a mock server that simulates texas responses and point to its url
    - most complex, but also most realistic, the texas client code is also tested including serdes and error handling
- [x] set up docker compose with postgres
- [x] add health endpoint
- [x] add metrics endpoint
- [x] add postgres and migration
  - exposed with R2DBC
- [x] integrate with arbeidsgiver-altinn-tilganger
- [x] test with integration to other services like arbeidsgiver-altinn-tilganger, arena, gosys etc
  - [x] option 1 use externalServices available in ktor server tests
    - simplest, requires the client to be passed from test to app code
  - [ ] option 2 use mock server like wiremock or roll our own
    - more complex, but also more realistic, the client code is also tested including serdes and error handling
- [x] endepunkt for lagre utkast, men optional felt
- [x] endepunkt for sende inn søknad
- [x] endepunkt for hente virksomheter
- [ ] kjøre app lokalt med lokal frontend
- [ ] sette opp frontend til å kjøre mot lokal backend
- [ ] postgres backed event bus for work coordination
  - EventBus publisher 
  - EventBus subscriber
  - Event Model centralized and strongly types
  - Event store using postgres, type is known, eventmodel is stored as jsonb
  - When event is published, it is stored in the event store and then published to the bus
  - When event is received, it is marked as processed in the event store
  - Event processing is idempotent, if the same event is received multiple times, it is only processed once
  - Event processing is transactional, if the processing fails, the event is not marked as processed
  - Event processing is retried, if the processing fails, it is retried after a delay
  - Event processing is ordered, events are processed in the order they are received
  - When event is completed, the event is moved from store to event log for later debugging and tracing
  - Event log is queryable, to see the history of events and their status
- [ ] trace logging to postgres and teamlogs:
  - traceId=correlationId 
  - ktorServerReq/ktorServerRes 
  - ktorClientReq/ktorClientRes
- [ ] set up github actions for build and test
- [ ] teamlogs
  - with no masking
  - no marker routing, all logs go to both,
  - maskingappender masks all forms of pii
  - teamLogsContext field with metadata that only gets to teamlogs
