CREATE TABLE IF NOT EXISTS soknad (id uuid PRIMARY KEY, virksomhetsnummer TEXT NOT NULL, virksomhetsnavn TEXT NOT NULL, kontaktperson_navn TEXT NOT NULL, kontaktperson_epost TEXT NOT NULL, kontaktperson_telefon TEXT NOT NULL, beliggenhetsadresse TEXT NULL, ansatt_fnr TEXT NOT NULL, ansatt_navn TEXT NOT NULL, ekspert_navn TEXT NOT NULL, ekspert_virksomhet TEXT NOT NULL, ekspert_kompetanse TEXT NOT NULL, behov_for_bistand_begrunnelse TEXT NOT NULL, behov_for_bistand TEXT NOT NULL, behov_for_bistand_estimert_kostnad TEXT NOT NULL, behov_for_bistand_timer TEXT NOT NULL, behov_for_bistand_tilrettelegging TEXT NOT NULL, behov_for_bistand_startdato DATE NOT NULL, nav_kontaktperson TEXT NOT NULL, opprettet_av TEXT NOT NULL, opprettet_tidspunkt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, status TEXT NOT NULL);
CREATE INDEX soknad_virksomhetsnummer ON soknad (virksomhetsnummer);
CREATE TABLE IF NOT EXISTS utkast (id uuid PRIMARY KEY, virksomhetsnummer TEXT NULL, virksomhetsnavn TEXT NULL, kontaktperson_navn TEXT NULL, kontaktperson_epost TEXT NULL, kontaktperson_telefon TEXT NULL, ansatt_fnr TEXT NULL, ansatt_navn TEXT NULL, ekspert_navn TEXT NULL, ekspert_virksomhet TEXT NULL, ekspert_kompetanse TEXT NULL, behov_for_bistand_begrunnelse TEXT NULL, behov_for_bistand TEXT NULL, behov_for_bistand_estimert_kostnad TEXT NULL, behov_for_bistand_timer TEXT NULL, behov_for_bistand_tilrettelegging TEXT NULL, behov_for_bistand_startdato DATE NULL, nav_kontaktperson TEXT NULL, opprettet_av TEXT NOT NULL, opprettet_tidspunkt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL);
CREATE INDEX utkast_virksomhetsnummer ON utkast (virksomhetsnummer);
CREATE INDEX utkast_opprettet_av ON utkast (opprettet_av);
CREATE TABLE IF NOT EXISTS event_queue (id BIGSERIAL PRIMARY KEY, event_json JSON NOT NULL, status INT DEFAULT 0 NOT NULL, attempts INT DEFAULT 0 NOT NULL, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL);
CREATE INDEX statusOppdatert ON event_queue (status, updated_at, id);
CREATE TABLE IF NOT EXISTS event_log (id BIGINT PRIMARY KEY, event_json JSON NOT NULL, status INT NOT NULL, errors JSON DEFAULT '[]'::json NOT NULL, attempts INT DEFAULT 0 NOT NULL, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL);
CREATE TABLE IF NOT EXISTS projection_builder_state (builder_name TEXT PRIMARY KEY, "position" BIGINT DEFAULT 0 NOT NULL);
CREATE TABLE IF NOT EXISTS event_handler_states (id BIGINT, handler_id TEXT, "result" JSON NOT NULL, error_message TEXT NULL, CONSTRAINT pk_event_handler_states PRIMARY KEY (id, handler_id));
CREATE TABLE IF NOT EXISTS idempotency_guard_records (event_id BIGINT NOT NULL, sub_task TEXT NOT NULL, event_name TEXT NOT NULL, status VARCHAR(13) NOT NULL);
CREATE TABLE IF NOT EXISTS arena_sak (saksnummer TEXT NOT NULL, "løpenummer" INT NOT NULL, "år" INT NOT NULL, tiltakgjennomforing_id INT NOT NULL, soknad TEXT NOT NULL);
CREATE TABLE IF NOT EXISTS tilsagndata (id uuid NOT NULL, tilsagnnummer TEXT NOT NULL, soknad_id uuid NULL, "tilsagnData" JSON NOT NULL);
CREATE TABLE IF NOT EXISTS tilskuddsbrev_vist_state (tilsagn_nummer TEXT PRIMARY KEY, tilskuddsbrev_opprettet_at TIMESTAMP NOT NULL, tilskuddsbrev_foerstvist_at TIMESTAMP NULL);
CREATE TABLE IF NOT EXISTS soknad_behandlet_forsinkelse_state (soknad_id TEXT PRIMARY KEY, innsendt_at TIMESTAMP NOT NULL, godkjent_at TIMESTAMP NULL, avlystt_at TIMESTAMP NULL);
CREATE SEQUENCE IF NOT EXISTS event_queue_id_seq START WITH 1 MINVALUE 1 MAXVALUE 9223372036854775807;
